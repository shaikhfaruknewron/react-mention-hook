"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=t(e);function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,u=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(u.push(r.value),u.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return u}}(e,t)||i(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}var u=function(t){var n=o(e.useState(""),2),r=n[0],i=n[1],u=o(e.useState([]),2),l=u[0],c=u[1],s=o(e.useState(!1),2),f=s[0],d=s[1],m=o(e.useState([]),2),v=m[0],g=m[1],h=o(e.useState(-1),2),y=h[0],p=h[1],S=e.useCallback((function(e,n){i(e);var r=e.slice(0,n).split(/\s/),o=r[r.length-1];if(o.startsWith("@")){d(!0),p(n-o.length);var a=o.slice(1),u=t.filter((function(e){return e.name.toLowerCase().includes(a.toLowerCase())}));c(u)}else d(!1)}),[t]),b=e.useCallback((function(e){var t=r.slice(0,y),n=r.slice(y+e.name.length),o="".concat(t).concat(e.name," ").concat(n);return g((function(t){return[].concat(a(t),[e])})),i(o),d(!1),{newText:o,newCursorPosition:y+e.name.length+1}}),[r,y]),E=e.useCallback((function(e){var t=r.replace(e.name,"").replace(/\s+/g," ").trim();return i(t),g((function(t){return t.filter((function(t){return t.id!==e.id}))})),t}),[r]);return{editorState:r,setEditorState:i,mentionSuggestions:l,showTooltip:f,mentionedUsers:v,handleInputChange:S,handleSelectMention:b,removeMention:E}};exports.MentionEditor=function(t){var r=t.suggestions,o=t.onChange,a=t.onSend,i=e.useRef(null),l=e.useRef(null),c=u(r),s=c.editorState;c.setEditorState;var f=c.mentionSuggestions,d=c.showTooltip,m=c.mentionedUsers,v=c.handleInputChange,g=c.handleSelectMention,h=c.removeMention;e.useEffect((function(){var e=function(e){!l.current||l.current.contains(e.target)||i.current.contains(e.target)||setShowTooltip(!1)};return document.addEventListener("mousedown",e),function(){return document.removeEventListener("mousedown",e)}}),[]);return n.default.createElement("div",{className:"mention-editor"},m.length>0&&n.default.createElement("div",{className:"mentioned-users"},m.map((function(e){return n.default.createElement("span",{key:e.id,className:"mention-tag"},"@",e.name,n.default.createElement("button",{onClick:function(){return t=h(e),void o(t);var t}},"Ã—"))}))),n.default.createElement("div",{className:"editor-container"},n.default.createElement("textarea",{ref:i,value:s,onChange:function(e){var t=e.target.value,n=e.target.selectionStart;v(t,n),o(t)},placeholder:"Type @ to mention..."}),d&&n.default.createElement("div",{ref:l,className:"mention-suggestions"},f.map((function(e){return n.default.createElement("div",{key:e.id,onClick:function(){return t=g(e),n=t.newText,r=t.newCursorPosition,o(n),void setTimeout((function(){i.current.setSelectionRange(r,r),i.current.focus()}),0);var t,n,r},className:"suggestion-item"},e.name)})))),n.default.createElement("button",{onClick:function(){return a(s)}},"Send"))},exports.useMention=u;
